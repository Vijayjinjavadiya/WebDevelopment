var ai_web_lib;(()=>{"use strict";var e={d:(o,t)=>{for(var s in t)e.o(t,s)&&!e.o(o,s)&&Object.defineProperty(o,s,{enumerable:!0,get:t[s]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},o={};e.r(o),e.d(o,{TensorflowModel:()=>t});class t{constructor(e,o){this.modelName=e,this.shapes=o,this.lengths=this.shapes.map(e=>e.reduce((e,o)=>e*o)),this.model=void 0,this.state="not_loaded",this.modelLoadingPromise=void 0,console.log("TensorflowModel constructor: ",this.modelName)}async _getTensorflow(){if(!window.tensorflow){if(window.tensorflowModelLoadingPromise)return window.tensorflowModelLoadingPromise;console.log("Loading TensorFlow...");const e=document.createElement("script");return e.setAttribute("src","/bundle/ai-tensorflow-web-lib/ai_tensorflow_web_lib.bundle.js"),e.setAttribute("type","text/javascript"),e.setAttribute("charset","utf-8"),document.head.appendChild(e),window.tensorflowModelLoadingPromise=new Promise((o,t)=>{e.onload=()=>{if(window.tensorflow)console.log("TensorFlow loaded"),o(window.tensorflow);else{const e=setInterval(()=>{window.tensorflow?(console.log("TensorFlow loaded"),clearInterval(e),o(window.tensorflow)):console.log("Waiting for TensorFlow...")},100)}},e.onerror=()=>{console.error("Error loading TensorFlow"),t()}}),window.tensorflowModelLoadingPromise}return window.tensorflow}loaded(){return"loaded"===this.state}summary(){"loaded"===this.state&&void 0!==this.model?this.model.summary():console.log("Model not loaded")}load(){return null!=this.modelLoadingPromise||(this.modelLoadingPromise=this.loadingInternal()),this.modelLoadingPromise}async loadingInternal(){return new Promise(async(e,o)=>{console.log("loadingInternal",this.modelName);const t=await this._getTensorflow();t?(this.state="loading",this.model=await t.loadLayersModel(this.modelName,{strict:!0}).then(e=>(this.state="loaded",console.log("tensorflow model success",this.modelName),e),e=>{this.modelLoadingPromise=void 0,this.state="error",console.error("tensorflow model error",this.modelName,e)}),this.model?e():o(null)):console.error("tensorflow not loaded yet")})}async predictAsync(e){const o=await this._getTensorflow();return o?this.predict(e,o):(console.error("tensorflow not loaded yet"),[])}predict(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.tensorflow;if(!o)return console.debug("tensorflow not loaded yet"),[];if("loaded"!==this.state||void 0===this.model)return[];const t=o.tensor(e);for(var s=[],n=0,r=0;r<this.shapes.length;r++)s.push(o.reshape(o.slice(t,n,this.lengths[r]<0?-1:this.lengths[r]),this.shapes[r])),n+=this.lengths[r];if(s.length!=this.model.inputs.length)throw`Unexpected tensor length, created ${s.length} tensors instead of ${this.model.inputs.length} expected tensors, shapes is [${this.shapes}] and input data [${e}]`;var l=this.model.predict(s);if(Array.isArray(l)){for(var i in l)l[i]=o.reshape(l[i],[-1]);l=o.concat(l,0)}return o.reshape(l,[-1]).arraySync()}async getBackend(){const e=await this._getTensorflow();return e?e.getBackend():(console.error("tensorflow not loaded yet"),"")}async setBackend(e){const o=await this._getTensorflow();o?o.setBackend(e):console.error("tensorflow not loaded yet")}}ai_web_lib=o})();